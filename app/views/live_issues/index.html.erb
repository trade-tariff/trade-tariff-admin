<h2>
  Manage live issues
</h2>

<p>
  Use this page to manage live issues with unresolved data affecting data outputs, workflows, or business rules.
</p>

<% if policy(LiveIssue).create? %>
  <%= link_to 'Add a Live Issue', new_live_issue_path, class: 'govuk-button' %>
<% end %>

<table class="govuk-table">
  <caption class="govuk-table__caption govuk-table__caption--m">Live Issues</caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">ID</th>
      <th scope="col" class="govuk-table__header">Issue</th>
      <th scope="col" class="govuk-table__header">Status</th>
      <th scope="col" class="govuk-table__header">Dates Affected</th>
      <th scope="col" class="govuk-table__header">Actions</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <% @live_issues.each do |issue| %>
      <tr class="govuk-table__row">
        <td class="govuk-table__cell"><%= issue.resource_id %></td>
        <td class="govuk-table__cell"><%= issue.title %></td>
        <td class="govuk-table__cell"><%= issue.status %></td>
        <td class="govuk-table__cell"><%= "#{issue.date_discovered.to_date.strftime("%d/%m/%Y")} - #{issue.date_resolved&.to_date&.strftime("%d/%m/%Y")}" %></td>
        <td class="govuk-table__cell">
          <% if policy(issue).update? %>
            <%= link_to 'Edit', edit_live_issue_path(issue.resource_id), class: 'govuk-link' %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
