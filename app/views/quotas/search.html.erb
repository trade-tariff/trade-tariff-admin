<%= link_to 'Back', quota_search_path, class: 'govuk-back-link' %>

<h1>Quota <%= @current_quota_definition.quota_order_number_id %> - definitions and balances</h1>

<dl class="govuk-summary-list">
  <h2>Core quota data</h2>

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Quota order number
    </dt>
    <dd class="govuk-summary-list__value">
      <%= @current_quota_definition.quota_order_number_id %>
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Quota type
    </dt>
    <dd class="govuk-summary-list__value">
      <%= @current_quota_definition.quota_type %>
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Origin(s)
    </dt>
    <dd class="govuk-summary-list__value">
      <% @current_quota_definition.quota_order_number_origins.each do |quota_order_number_origin| %>
        <%= quota_order_number_origin.geographical_area_id %>(<%= quota_order_number_origin.geographical_area_description %>) <%= format_quota_dates quota_order_number_origin %></br>
      <% end %>
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Quota dates
    </dt>
    <dd class="govuk-summary-list__value">
      <%= format_quota_dates(@current_quota_definition).upcase_first %>
    </dd>
  </div>
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Commodities and measures
    </dt>
    <dd class="govuk-summary-list__value">
    </dd>
  </div>
</dl>

<h1>Definition periods for quota <%= @current_quota_definition.quota_order_number_id %></h1>

<p>
  Changes to quota balance for quota definition <%= @current_quota_definition.id %> running from <%= @current_quota_definition.validity_start_date.to_date.to_formatted_s(:govuk) %> to <%= @current_quota_definition.validity_end_date.to_date.to_formatted_s(:govuk) %>
</p>

<p>
  Initial volume is <%= @current_quota_definition.initial_volume %> <%= @current_quota_definition.measurement_unit %>
</p>

<%= tag.div tag.canvas(
  id: "quota-definitions-chart",
  width: "800",
  height: "450",
  data: {
    measurementunitcode: @current_quota_definition.measurement_unit,
    importedamounts: @current_quota_definition.imported_amounts,
    newbalances: @current_quota_definition.new_balances,
    occurrencetimestamps: @current_quota_definition.occurrence_timestamps,
  }
) %>

<% @quota_definitions.each do |quota_definition|  %>
  <p>
    <%= quota_definition.id %>
    <br>
    <%= quota_definition.validity_start_date %>
    <br>
    <%= quota_definition.validity_end_date %>
    <br>
    <%= quota_definition.quota_balance_events.first.imported_amount %>
  </p>
<% end %>

<%= javascript_pack_tag 'quota-definition-chart' %>
